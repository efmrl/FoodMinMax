<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FoodMinMax - Optimize Your Nutrition</title>
        <link rel="icon" type="image/svg+xml" href="favicon.svg" />
        <link rel="apple-touch-icon" href="apple-touch-icon.png" />
        <link rel="stylesheet" href="styles.css" />
        <script type="module" src="foodOptimizer.js"></script>
    </head>
    <body>
        <main x-data="foodOptimizer()" x-init="init()">
            <header>
                <nav>
                    <ul>
                        <li><strong>Food Min Max</strong></li>
                    </ul>
                    <ul>
                        <li>
                            <details class="dropdown">
                                <summary>üë§</summary>
                                <ul>
                                    <li>
                                        <a href="#">About</a>
                                    </li>
                                    <li>
                                        <a href="#" @click.prevent.stop="exportData($event)">Export Data</a>
                                    </li>
                                    <li>
                                        <a href="#" @click.prevent.stop="openImportModal()">Import Data</a>
                                    </li>
                                    <li>
                                        <a href="#">Credits</a>
                                    </li>
                                    <li>
                                        <a href="#">Logout</a>
                                    </li>
                                </ul>
                            </details>
                        </li>
                    </ul>
                </nav>

                <h1>FoodMinMax</h1>
                <div role="group">
                    <button @click="openConstraintsModal()">
                        Set Constraints
                    </button>
                    <button @click="openAddFoodModal()">
                        Add Food
                    </button>
                </div>
            </header>

            <!-- Foods List Section -->
            <article x-show="foods.length > 0">
                <header>
                    <h2>Your Foods</h2>
                    <p><span x-text="foods.length"></span> foods added</p>
                </header>
                <figure>
                    <table>
                        <thead>
                            <tr>
                                <th data-sortable @click="sortBy('name')">
                                    Food
                                    <span
                                        x-show="sortField === 'name'"
                                        x-text="sortOrder === 'asc' ? '‚Üë' : '‚Üì'"
                                    ></span>
                                </th>
                                <th
                                    class="text-center"
                                    data-sortable
                                    @click="sortBy('proteinPercent')"
                                >
                                    Protein %
                                    <span
                                        x-show="sortField === 'proteinPercent'"
                                        x-text="sortOrder === 'asc' ? '‚Üë' : '‚Üì'"
                                    ></span>
                                </th>
                                <th
                                    class="text-center"
                                    data-sortable
                                    @click="sortBy('caloriePercent')"
                                >
                                    Calorie %
                                    <span
                                        x-show="sortField === 'caloriePercent'"
                                        x-text="sortOrder === 'asc' ? '‚Üë' : '‚Üì'"
                                    ></span>
                                </th>
                                <th
                                    class="text-center"
                                    data-sortable
                                    @click="sortBy('sodiumPercent')"
                                >
                                    Sodium %
                                    <span
                                        x-show="sortField === 'sodiumPercent'"
                                        x-text="sortOrder === 'asc' ? '‚Üë' : '‚Üì'"
                                    ></span>
                                </th>
                                <th
                                    class="text-center"
                                    data-sortable
                                    @click="sortBy('proteinVsCalorie')"
                                >
                                    P/C Ratio
                                    <span
                                        x-show="sortField === 'proteinVsCalorie'"
                                        x-text="sortOrder === 'asc' ? '‚Üë' : '‚Üì'"
                                    ></span>
                                </th>
                                <th
                                    class="text-center"
                                    data-sortable
                                    @click="sortBy('proteinVsSodium')"
                                >
                                    P/S Ratio
                                    <span
                                        x-show="sortField === 'proteinVsSodium'"
                                        x-text="sortOrder === 'asc' ? '‚Üë' : '‚Üì'"
                                    ></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <template
                                x-for="(food, index) in sortedFoods"
                                :key="index"
                            >
                                <tr
                                    @click="openEditModal(food, foods.indexOf(food))"
                                >
                                    <td>
                                        <strong x-text="food.name"></strong>
                                        <small class="extra-info">
                                            <span x-text="food.calories"></span
                                            >cal,
                                            <span x-text="food.sodium"></span
                                            >mg,
                                            <span x-text="food.protein"></span>g
                                        </small>
                                    </td>
                                    <td class="text-center">
                                        <strong
                                            :class="getProteinPercentClass(food)"
                                            x-text="getProteinPercent(food) + '%'"
                                        ></strong>
                                        <small
                                            class="extra-info"
                                            x-text="'(' + food.protein + 'g)'"
                                        ></small>
                                    </td>
                                    <td class="text-center">
                                        <strong
                                            :class="getCaloriePercentClass(food)"
                                            x-text="getCaloriePercent(food) + '%'"
                                        ></strong>
                                        <small
                                            class="extra-info"
                                            x-text="'(' + food.calories + ')'"
                                        ></small>
                                    </td>
                                    <td class="text-center">
                                        <strong
                                            :class="getSodiumPercentClass(food)"
                                            x-text="getSodiumPercent(food) + '%'"
                                        ></strong>
                                        <small
                                            class="extra-info"
                                            x-text="'(' + food.sodium + 'mg)'"
                                        ></small>
                                    </td>
                                    <td class="text-center">
                                        <strong
                                            :class="getProteinVsCalorieClass(food)"
                                            x-text="getProteinVsCalorieRatio(food)"
                                        ></strong>
                                        <small class="extra-info"
                                            >protein vs calorie</small
                                        >
                                    </td>
                                    <td class="text-center">
                                        <strong
                                            :class="getProteinVsSodiumClass(food)"
                                            x-text="getProteinVsSodiumRatio(food)"
                                        ></strong>
                                        <small class="extra-info"
                                            >protein vs sodium</small
                                        >
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </figure>
            </article>

            <!-- Empty State -->
            <article x-show="foods.length === 0">
                <h3>üçé No foods added yet</h3>
                <p>
                    Start by adding some foods above to see how they fit your
                    nutritional goals.
                </p>
            </article>

            <!-- Edit Food Modal -->
            <dialog
                x-ref="editModal"
                x-show="editingFood"
                @click.self="closeEditModal()"
                @keydown.escape.window="closeEditModal()"
                open
            >
                <article>
                    <header>
                        <button
                            @click="closeEditModal()"
                            aria-label="Close"
                            class="close"
                        ></button>
                        <h3>Edit Food</h3>
                    </header>
                    <label>
                        Food Name
                        <input
                            type="text"
                            x-model="editForm.name"
                            placeholder="Chicken breast"
                        />
                    </label>
                    <label>
                        Calories
                        <input
                            type="number"
                            x-model="editForm.calories"
                            placeholder="165"
                        />
                    </label>
                    <label>
                        Sodium (mg)
                        <input
                            type="number"
                            x-model="editForm.sodium"
                            placeholder="74"
                        />
                    </label>
                    <label>
                        Protein (g)
                        <input
                            type="number"
                            x-model="editForm.protein"
                            placeholder="31"
                        />
                    </label>
                    <footer>
                        <button @click="saveEditedFood()">Save Changes</button>
                        <button @click="closeEditModal()" class="secondary">
                            Cancel
                        </button>
                        <button
                            @click="confirm('Are you sure you want to remove this food? This cannot be undone.') && (removeFood(editingFoodIndex), closeEditModal())"
                            class="contrast"
                        >
                            Remove Food
                        </button>
                    </footer>
                </article>
            </dialog>

            <!-- Constraints Modal -->
            <dialog
                x-show="showConstraintsModal"
                @click.self="closeConstraintsModal()"
                @keydown.escape.window="closeConstraintsModal()"
                open
            >
                <article>
                    <header>
                        <button
                            @click="closeConstraintsModal()"
                            aria-label="Close"
                            class="close"
                        ></button>
                        <h3>Set Your Nutritional Constraints</h3>
                    </header>
                    <label>
                        Maximum Calories
                        <input
                            type="number"
                            x-model="constraints.maxCalories"
                            placeholder="2000"
                        />
                    </label>
                    <label>
                        Maximum Sodium (mg)
                        <input
                            type="number"
                            x-model="constraints.maxSodium"
                            placeholder="2300"
                        />
                    </label>
                    <label>
                        Minimum Protein (g)
                        <input
                            type="number"
                            x-model="constraints.minProtein"
                            placeholder="50"
                        />
                    </label>
                    <footer>
                        <button
                            @click="saveConstraints(); closeConstraintsModal()"
                        >
                            Save Constraints
                        </button>
                        <button
                            @click="closeConstraintsModal()"
                            class="secondary"
                        >
                            Cancel
                        </button>
                    </footer>
                </article>
            </dialog>

            <!-- Add Food Modal -->
            <dialog
                x-show="showAddFoodModal"
                @click.self="closeAddFoodModal()"
                @keydown.escape.window="closeAddFoodModal()"
                open
            >
                <article>
                    <header>
                        <button
                            @click="closeAddFoodModal()"
                            aria-label="Close"
                            class="close"
                        ></button>
                        <h3>Add Food</h3>
                    </header>
                    <label>
                        Food Name
                        <input
                            type="text"
                            x-model="newFood.name"
                            placeholder="Chicken breast"
                        />
                    </label>
                    <label>
                        Calories
                        <input
                            type="number"
                            x-model="newFood.calories"
                            placeholder="165"
                        />
                    </label>
                    <label>
                        Sodium (mg)
                        <input
                            type="number"
                            x-model="newFood.sodium"
                            placeholder="74"
                        />
                    </label>
                    <label>
                        Protein (g)
                        <input
                            type="number"
                            x-model="newFood.protein"
                            placeholder="31"
                        />
                    </label>
                    <footer>
                        <button @click="addFood(); closeAddFoodModal()">
                            Add Food
                        </button>
                        <button @click="closeAddFoodModal()" class="secondary">
                            Cancel
                        </button>
                    </footer>
                </article>
            </dialog>

            <!-- Import Modal -->
            <dialog
                x-show="showImportModal"
                @click.self="closeImportModal()"
                @keydown.escape.window="closeImportModal()"
                open
            >
                <article>
                    <header>
                        <button
                            @click="closeImportModal()"
                            aria-label="Close"
                            class="close"
                        ></button>
                        <h3>Import Data</h3>
                    </header>

                    <template x-if="!importPreview">
                        <div>
                            <p>Select a JSON file to import your food data.</p>
                            <label for="import-file">
                                <button
                                    type="button"
                                    class="secondary"
                                    onclick="document.getElementById('import-file').click()"
                                >
                                    Browse Files
                                </button>
                            </label>
                            <input
                                type="file"
                                id="import-file"
                                accept=".json"
                                @change="handleImportFileSelect($event)"
                                style="display: none"
                            />
                        </div>
                    </template>

                    <template x-if="importPreview">
                        <div>
                            <h4>Preview</h4>
                            <p>
                                <strong>Foods:</strong>
                                <span x-text="importPreview.foodsCount"></span>
                            </p>
                            <template x-if="importPreview.exportedAt">
                                <p>
                                    <strong>Exported At:</strong>
                                    <span x-text="importPreview.exportedAt"></span>
                                </p>
                            </template>
                        </div>
                    </template>

                    <footer>
                        <template x-if="importPreview">
                            <button @click="confirmImport()">
                                Import Data
                            </button>
                        </template>
                        <button @click="closeImportModal()" class="secondary">
                            <span x-text="importPreview ? 'Cancel' : 'Close'"></span>
                        </button>
                    </footer>
                </article>
            </dialog>
        </main>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
    </body>
</html>
